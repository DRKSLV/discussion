{"version":3,"file":"static/webpack/static\\development\\pages\\modal.js.045f2120fa7cda98e6c7.hot-update.js","sources":["webpack:///./components/layout/EyeOfJudgement.js"],"sourcesContent":["import EyeSVG from \"../../res/svg/eyeOfJudgementEllipseSVG\"\r\nimport { useRef, useLayoutEffect, createContext, useState, useContext, useCallback, useEffect } from \"react\";\r\nimport style from \"../../style/eye.module.sass\";\r\nimport generateId from \"../../helpers/uniqueId\";\r\nconst eyeContext = createContext();\r\n\r\n// TODO EYE starts flying from wrong points on the page when placeholder has position: ficed and placeholders are triggered from clicking on unrelated things.\r\n// this happens because of the useEffect call that pulls the eye when the position is off. the position is offset by scrolling, component rerenders and pulls the eye. Damn\r\n\r\n\r\nexport function EyePlaceholder(props) {\r\n    const placeholder = useRef();\r\n    const [id, setId] = useState(() => {return props.id || generateId()});\r\n    const context = useContext(eyeContext);\r\n    if(!context) return <div></div>;\r\n    const [active, pos, animating, {setActive, setPos, setSize, setColor, setAnimating, init}] = context;\r\n    const activeRef = useRef(active);\r\n    activeRef.current = active;\r\n\r\n    function becomeActive(evt) {\r\n        setPos(calcPos());\r\n        setSize(props.size);\r\n        setColor([props.baseColor, props.innerColor]);\r\n        setActive(id);\r\n        if (evt) evt.stopPropagation();\r\n    }   \r\n\r\n    function resetActive(act, ide) {\r\n        if(activeRef.current === id) {\r\n            setActive(\"default\");\r\n            setAnimating(true);\r\n        }\r\n    }\r\n\r\n    function calcPos() {\r\n        var bodyRect = document.body.getBoundingClientRect(),\r\n        elemRect = placeholder.current.getBoundingClientRect(),\r\n        offsetY   = elemRect.top - bodyRect.top,\r\n        offsetX = elemRect.left - bodyRect.left;\r\n        return [offsetX, offsetY];\r\n    }\r\n\r\n    useEffect(() => {\r\n        var currentPos = calcPos();\r\n        if(active === id && (pos[0] !== currentPos[0] || pos[1] !== currentPos[1] || !init)) {\r\n            console.log(id)\r\n            becomeActive();\r\n        }\r\n    })\r\n\r\n    var controllerObj; \r\n    if (props.controller) controllerObj = React.cloneElement(props.controller, {becomeActive, resetActive, active: active, id: id});\r\n\r\n    return (\r\n    <div onClick={becomeActive} ref={placeholder}>\r\n        <EyeOfJudgement \r\n            size={props.size}\r\n            show={active === id && !animating} \r\n            id={id}\r\n            baseColor={props.baseColor}\r\n            innerColor={props.innerColor}\r\n        />\r\n        {controllerObj}\r\n    </div>);\r\n}\r\n\r\nfunction EyeOfJudgement(props) {\r\n    var width = ((140/71)*props.size || 291)+\"px\";\r\n    var height = props.size+\"px\";\r\n    var grow = props.grow;\r\n    var show = props.show;\r\n    if(typeof(grow) !== \"boolean\") grow = true;\r\n    if(typeof(show) !== \"boolean\") show = true;\r\n    \r\n    var eee = {...props};\r\n    delete eee.style;\r\n    delete eee.baseColor;\r\n    delete eee.innerColor;\r\n    delete eee.show;\r\n    delete eee.grow;\r\n\r\n    var newStyle = {\"--base-color\": props.baseColor || \"#ff00fe\", \"--inner-color\": props.innerColor || \"#00f3ff\", ...props.style};\r\n\r\n    var Svg = \r\n    <EyeSVG \r\n        height={height} \r\n        width={width} \r\n        style={newStyle}\r\n        {...eee}\r\n    />;\r\n\r\n    return grow ?(\r\n        <div\r\n            className={style.eyeWrapper}\r\n            style={{ height, width }}\r\n        >\r\n            <div className={style.eye} style={{display: show ? \"block\" : \"none\"}}>\r\n                {Svg}\r\n            </div>\r\n        </div>\r\n    ) : Svg;\r\n}\r\n\r\nexport function EyeProvider(props) {\r\n    const [active, setActive] = useState(\"default\");\r\n    const [animating, setAnimating] = useState(false);\r\n    const [pos, setPos] = useState([undefined, undefined]);\r\n    const [size, setSize] = useState(400);\r\n    const [[baseColor, innerColor], setColor] = useState([\"\", \"\"]);\r\n    const activeRef = useRef();\r\n    const [init, setInit] = useState(false);\r\n\r\n    function setterPos(e, animate=true) {  \r\n        if(init && animate) {\r\n            setAnimating(true);\r\n        }\r\n        \r\n        /*clearTimeout(timer.current);\r\n        timer.current = setTimeout(() => {\r\n            setAnimating(false);\r\n        }, 300);*/\r\n        setPos(e);\r\n    }\r\n    function animEnd() {\r\n        setAnimating(false);\r\n    }\r\n\r\n    if(!init && typeof pos[0] !== \"undefined\" && !animating ) {\r\n        setInit(true);\r\n    }\r\n\r\n    return <eyeContext.Provider value={[active, pos, animating, {setActive, setPos: setterPos, setSize, setColor, setAnimating, init}]}>\r\n        {props.children}\r\n        <EyeOfJudgement \r\n            style={{top:pos[1], left:pos[0], visibility: animating ? \"visible\" : \"hidden\"}} \r\n            className={init ? style.flyingEye : undefined} \r\n            size={size} \r\n            grow={false}\r\n            onTransitionEnd={animEnd}\r\n            id=\"flying\"\r\n            baseColor={baseColor}\r\n            innerColor={innerColor}\r\n        />\r\n    </eyeContext.Provider>\r\n}\r\n\r\nexport function EyeOnMount(props) {\r\n    \r\n\r\n    return <EyePlaceholder controller={<OnMount/>} {...props}>\r\n\r\n    </EyePlaceholder>\r\n}\r\n\r\nfunction OnMount(props) {\r\n    useEffect(() => {\r\n        props.becomeActive();\r\n        return () => {props.resetActive();};\r\n    }, []);\r\n    return <div></div>;\r\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AAGA;AACA;AAEA;AACA;AACA;AAFA;AAEA;AAAA;AAFA;AAAA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAMA;AAEA;AACA;AAAA;AAAA;AAAA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AAKA;AACA;AAPA;AAAA;AAAA;AACA;AAQA;AAAA;AACA;AAAA;AACA;AACA;AAEA;;;;;;AAIA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWA;AAEA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;A","sourceRoot":""}